# Gene Knockout and Mutation Analysis

## Project Overview

This project analyzes the association between specific cancer mutations and gene knockout experiments using Welch's t-test in R. The analysis is encapsulated in a Singularity container, which includes all necessary dependencies and R scripts.

## Singularity Container

The container runs the R script `main.R` which:
- Loads mutation data (`Mutations.tsv`) and gene knockout data (`Gene_KOs.tsv`). 
- Performs Welch’s t-tests for each mutation-gene pair.
- Outputs results with False Discovery Rate (FDR) correction.
- Generates Q-Q plots, histograms, and volcano plots.
- Saves significant results and all plots in the output directory.



## Installation Instructions

### 1. Clone the repository

Clone the repository containing the `Singularity` definition file, R scripts, and data files:

```bash
git clone https://github.com/J-Andy/eQTL-analysis.git
cd eQTL-analysis
```

### 2. Build the Singularity image
You can build the Singularity image locally using the following command:
```bash
singularity build r-analysis.sif Singularity
```

If you don't have root access on the system, like me, you can use the remote build service:
```bash
singularity build --remote r-analysis.sif Singularity
```
### 3. Running the Analysis
After building the container, run the analysis using this script: 

./run_analysis.sh

**Make sure the `run_analysis.sh` script is executable**:
```bash
  chmod +x run_analysis.sh
```


The shell script will:
 - Create an output directory in your current directory.
 - Run the Singularity container and bind the local output directory to the container’s /usr/src/app/output.

### 4. Running Unit Tests
To run the unit tests, use ```bash run_tests.sh ``` script.

Unit Test Details

Data Alignment Test:
Ensures that the mutation data (Mutations.tsv) and gene knockout data (Gene_KOs.tsv) are properly aligned by common models (cell lines).
The test verifies that the aligned datasets share the same number of common cell lines.

T-test Validation:
Checks that Welch’s t-tests return valid p-values when comparing mutation presence with gene knockout outcomes.
The test simulates mutation and fold change data and ensures the p-value is numeric and less than 1.
Test Output:

If all tests pass, the script will print a success message: "All tests passed successfully!"

### 5. Outputs
The results and plots generated by the analysis are saved in the output directory. These include:

significant_mutation_gene_associations.tsv: A table of significant mutation-gene associations after FDR correction.
qqplot_pvalues.png: A Q-Q plot for visualizing the distribution of p-values.
histogram_pvalues.png: A histogram displaying the p-value distribution.
volcano_plot.png: A volcano plot of mutation-gene associations.
Boxplots: Individual PNG files for each significant mutation-gene association.


## Download the Prebuilt Singularity Image
If you prefer not to build the container yourself, you can download the prebuilt Singularity image (`r-analysis.sif`) from the following link: https://drive.google.com/file/d/17zTK5rTlSquPqw5A8xGvv1kwUP1szQDB/view?usp=sharing 
